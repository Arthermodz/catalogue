<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://unpkg.com/pdfjs-dist@3.9.179/build/pdf.worker.min.js';

const url = 'catalogue.pdf';
const container = document.getElementById('pdf-container');
const categoryList = document.getElementById('category-list');
const dropdown = document.querySelector('.dropdown');
const pageInput = document.getElementById('pageInput');

/* ===== CATEGORIES ===== */
const categories = {
  "WINNER": 3,
  "ELBAHDJA": 5,
  "FENNEC": 7,
  "FIORI": 9,
  "LINE": 11,
  "RIO": 13,
  "AZUR": 15,
  "AURORE": 17,
  "ECLIPSE": 19,
  "GHOUL": 5,
  "MITIGEUR CUISINE": 23,
  "COLONNE DE DOUCHE": 27,
  "ROBINET LAVABO": 37,
  "ROBINET ABLUTION": 38,
  "ROBINET DOUBLE SERVICE": 41,
  "ROBINET JARDIN": 42,
  "FLEXIBLE ET DOUCHETTE": 45,
  "BONDE POUSSOIRE": 46,
  "VANNES SPHÉRIQUE": 47,
  "FLOTTEUR": 49,
  "CLAPET ANTI-RETOUR": 50,
  "ROBINET ARRÊT DE GAZ": 51,
  "FLEXIBLE DE GAZ": 52,
  "PIÈCES À SERTIR": 53,
  "PIÈCES À VISSER": 58,
  "COLLECTEURS": 63,
  "JEUX DE ROBINET": 65
};

/* Toggle dropdown on mobile */
document.querySelector('.dropbtn').onclick = () => {
  dropdown.classList.toggle('open');
};

/* Build category list */
Object.entries(categories).forEach(([name, page]) => {
  const btn = document.createElement('button');
  btn.textContent = name;
  btn.onclick = () => {
    goToPage(page);
    dropdown.classList.remove('open');
  };
  categoryList.appendChild(btn);
});

/* Load PDF */
pdfjsLib.getDocument(url).promise.then(pdf => {

  const renderPage = (num) => {
    pdf.getPage(num).then(page => {

      const containerWidth = container.clientWidth;
      let scale = 1.5;
      if(containerWidth <= 480) scale = 2.0;
      if(containerWidth <= 360) scale = 2.5;

      const viewport = page.getViewport({ scale });

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      page.render({ canvasContext: ctx, viewport }).promise.then(() => {
        container.appendChild(canvas);
        canvas.dataset.page = num;

        if(num < pdf.numPages) renderPage(num + 1);
      });
    });
  };

  renderPage(1);
});

/* Navigation */
function goToPage(num) {
  const target = document.querySelector(`canvas[data-page="${num}"]`);
  if (!target) return;

  target.scrollIntoView({
    behavior: 'smooth',
    block: 'start'
  });

  window.scrollBy(0, -130); // header offset
}
</script>
